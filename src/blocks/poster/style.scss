/**
 * Poster Block Styles - Frontend and editor shared
 */

// Mixin for hover/touch active states
@mixin poster-active-state {

	&:hover,
	&.is-touched {
		@content;
	}
}

// Common styles for hiding default content in active state
@mixin hide-default-content {

	.wp-block-shm-poster-content-default {
		opacity: 0;
		pointer-events: none;
	}
}

// Common styles for showing hover content in active state
@mixin show-hover-content {

	.wp-block-shm-poster-content-hover {
		opacity: 1;
		pointer-events: auto;
		z-index: 3;
	}
}

// Mixin for content animation base styles
@mixin content-animation-base($transform: null) {

	.wp-block-shm-poster-content-hover > * {
		opacity: 0;

		@if $transform {
			transform: $transform;
			transition:
				opacity var(--poster-transition-duration) var(--poster-transition-easing),
				transform var(--poster-transition-duration) var(--poster-transition-easing);
		} @else {
			transition: opacity var(--poster-transition-duration) var(--poster-transition-easing);
		}
	}

	@include poster-active-state {

		.wp-block-shm-poster-content-hover > * {
			opacity: 1;

			@if $transform {
				transform: none;
			}

			transition-delay: var(--poster-content-delay);
		}
	}
}

// Base styles - modeled after Cover block for consistent carousel behavior
.wp-block-shm-poster {
	--poster-overlay-color: #000;
	--poster-overlay-color-rgb: 0, 0, 0;
	--poster-overlay-opacity: 0.6;
	--poster-overlay-opacity-hover: 0.8;
	--poster-overlay-height: 30%;
	--poster-overlay-height-hover: 100%;
	--poster-transition-duration: 400ms;
	--poster-transition-easing: ease-in-out;
	--poster-content-delay: 100ms;
	--poster-min-height: 430px; // Match Cover block default
	--poster-focal-x: 50%;
	--poster-focal-y: 50%;

	// Cover-like base properties
	position: relative;
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
	align-items: stretch;
	box-sizing: border-box;
	overflow: hidden;
	width: 100%;
	height: 100%; // Fill parent container (like Cover block)
	min-height: var(--poster-min-height);
	background-color: #1a1a1a;

	// Flex item support - allow block to fill parent
	flex: 1 1 auto;
	min-width: 0; // Prevent flex item overflow

	&[style*="--poster-aspect-ratio"] {
		aspect-ratio: var(--poster-aspect-ratio);
		min-height: unset;
	}
}

// Make parent flex items stretch when containing a Poster block
// This ensures Poster matches sibling heights in carousels/sliders
// stylelint-disable-next-line no-descending-specificity
*:has(> .wp-block-shm-poster),
.swiper-slide:has(.wp-block-shm-poster),
.splide__slide:has(.wp-block-shm-poster),
.glide__slide:has(.wp-block-shm-poster),
.slick-slide:has(.wp-block-shm-poster),
.flickity-slider > *:has(.wp-block-shm-poster) {
	align-self: stretch;
}

.shm-poster__image {
	position: absolute;
	inset: 0;
	width: 100%;
	height: 100%;
	object-fit: cover;
	object-position: var(--poster-focal-x) var(--poster-focal-y);
	transition:
		filter var(--poster-transition-duration) var(--poster-transition-easing),
		transform var(--poster-transition-duration) var(--poster-transition-easing);
}

.shm-poster__link {
	display: block;
	position: absolute;
	inset: 0;
	text-decoration: none;
	color: inherit;
	cursor: pointer;

	&[data-no-link="true"] {
		cursor: default;
	}

	&:hover,
	&:focus,
	&:active {
		text-decoration: none;
		color: inherit;
	}

	&:focus-visible {
		outline: 2px solid #fff;
		outline-offset: -4px;
	}
}

.shm-poster__overlays {
	display: contents;
}

// Content child blocks - base styles
.wp-block-shm-poster-content-default,
.wp-block-shm-poster-content-hover {
	position: absolute;
	left: 0;
	right: 0;
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
	padding: 1.5rem;
	box-sizing: border-box;
	color: #fff;
	transition:
		height var(--poster-transition-duration) var(--poster-transition-easing),
		opacity var(--poster-transition-duration) var(--poster-transition-easing),
		transform var(--poster-transition-duration) var(--poster-transition-easing);

	a {
		color: inherit;
	}

	h1,
	h2,
	h3,
	h4,
	h5,
	h6 {
		margin-top: 0;
		margin-bottom: 0.5em;
		color: inherit;
	}

	p {
		margin-top: 0;
		margin-bottom: 0.5em;

		&:last-child {
			margin-bottom: 0;
		}
	}
}

.wp-block-shm-poster-content-default {
	bottom: 0;
	height: var(--poster-overlay-height);
	background: rgba(var(--poster-overlay-color-rgb), var(--poster-overlay-opacity));
	z-index: 2;
}

.wp-block-shm-poster-content-hover {
	bottom: 0;
	height: var(--poster-overlay-height);
	background: rgba(var(--poster-overlay-color-rgb), var(--poster-overlay-opacity-hover));
	opacity: 0;
	pointer-events: none;
	z-index: 1;

	// Center content vertically when expanded to full height
	&.is-centered,
	.wp-block-shm-poster:hover &,
	.wp-block-shm-poster.is-touched & {
		justify-content: center;
	}
}

// Position: Top
.wp-block-shm-poster--position-top {

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-default,
	.wp-block-shm-poster-content-hover {
		top: 0;
		bottom: auto;
		justify-content: flex-start;
	}

	// Override: center hover content when active
	@include poster-active-state {

		.wp-block-shm-poster-content-hover {
			justify-content: center;
		}
	}
}

// Animation: Slide (default)
.wp-block-shm-poster--animation-slide {

	@include poster-active-state {

		@include hide-default-content;

		.wp-block-shm-poster-content-hover {
			height: var(--poster-overlay-height-hover);
			opacity: 1;
			pointer-events: auto;
			z-index: 3;
		}
	}
}

// Animation: Fade
.wp-block-shm-poster--animation-fade {

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-default,
	.wp-block-shm-poster-content-hover {
		inset: 0;
		height: auto;
	}

	@include poster-active-state {

		@include hide-default-content;
		@include show-hover-content;
	}
}

// Animation: Scale
.wp-block-shm-poster--animation-scale {

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-default {
		transform-origin: bottom center;
	}

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-hover {
		height: 100%;
		transform: scaleY(0);
		transform-origin: bottom center;
	}

	&.wp-block-shm-poster--position-top {

		.wp-block-shm-poster-content-default,
		.wp-block-shm-poster-content-hover {
			transform-origin: top center;
		}
	}

	@include poster-active-state {

		@include hide-default-content;

		.wp-block-shm-poster-content-hover {
			transform: scaleY(1);
			opacity: 1;
			pointer-events: auto;
			z-index: 3;
		}
	}
}

// Animation: Blur
.wp-block-shm-poster--animation-blur {

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-hover {
		inset: 0;
		height: auto;
	}

	@include poster-active-state {

		.shm-poster__image {
			filter: blur(8px);
			transform: scale(1.05);
		}

		@include hide-default-content;
		@include show-hover-content;
	}
}

// Animation: Slide-Fade
.wp-block-shm-poster--animation-slide-fade {

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-default {
		transform: translateY(0);
	}

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-hover {
		transform: translateY(20px);
	}

	&.wp-block-shm-poster--position-top .wp-block-shm-poster-content-hover {
		transform: translateY(-20px);
	}

	@include poster-active-state {

		.wp-block-shm-poster-content-default {
			opacity: 0;
			transform: translateY(-20px);
			pointer-events: none;
		}

		.wp-block-shm-poster-content-hover {
			height: var(--poster-overlay-height-hover);
			opacity: 1;
			transform: translateY(0);
			pointer-events: auto;
			z-index: 3;
		}
	}

	&.wp-block-shm-poster--position-top {

		@include poster-active-state {

			.wp-block-shm-poster-content-default {
				transform: translateY(20px);
			}
		}
	}
}

// Content Animation: Fade-Up
.wp-block-shm-poster--content-fade-up {

	@include content-animation-base(translateY(20px));
}

// Content Animation: Fade
.wp-block-shm-poster--content-fade {

	@include content-animation-base;
}

// Content Animation: Scale
.wp-block-shm-poster--content-scale {

	@include content-animation-base(scale(0.9));
}

// Content Animation: Stagger
.wp-block-shm-poster--content-stagger {

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-hover > * {
		opacity: 0;
		transform: translateY(15px);
		transition:
			opacity var(--poster-transition-duration) var(--poster-transition-easing),
			transform var(--poster-transition-duration) var(--poster-transition-easing);
	}

	@include poster-active-state {

		.wp-block-shm-poster-content-hover > * {
			opacity: 1;
			transform: translateY(0);

			@for $i from 1 through 10 {
				&:nth-child(#{$i}) {
					transition-delay: calc(var(--poster-content-delay) + #{($i - 1) * 50}ms);
				}
			}
		}
	}
}

// Content Animation: None (slide with overlay)
// Content moves together with the overlay - no separate fade animation
.wp-block-shm-poster--content-none {

	// Position hover content at top of overlay
	// so it slides up with the expanding overlay
	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-hover {
		justify-content: flex-start;
	}

	// No opacity/transform transitions on children
	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-hover > * {
		opacity: 1;
		transform: none;
	}

	@include poster-active-state {

		// stylelint-disable-next-line no-descending-specificity
		.wp-block-shm-poster-content-hover {
			justify-content: flex-start;
		}
	}
}

// No content fade modifier - hover content visible from start
.wp-block-shm-poster--no-content-fade {

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-hover {
		opacity: 1;
	}

	// Children visible immediately, no opacity animation
	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-hover > * {
		opacity: 1 !important;
		transition: transform var(--poster-transition-duration) var(--poster-transition-easing) !important;
	}
}

// Accessibility: Focus states
.wp-block-shm-poster:has(.shm-poster__link:focus-visible) {

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-default {
		opacity: 0;
		pointer-events: none;
	}

	// stylelint-disable-next-line no-descending-specificity
	.wp-block-shm-poster-content-hover {
		height: var(--poster-overlay-height-hover);
		opacity: 1;
		pointer-events: auto;
		z-index: 3;
	}
}

// Accessibility: Reduced motion
@media (prefers-reduced-motion: reduce) {

	.wp-block-shm-poster,
	.wp-block-shm-poster *,
	.wp-block-shm-poster *::before,
	.wp-block-shm-poster *::after {
		transition-duration: 0.01ms !important;
		animation-duration: 0.01ms !important;
	}
}
