/**
 * Poster Block Styles - Frontend and editor shared
 * New architecture: Single overlay with reveal-based animation
 */

// Mixin for hover/touch active states
@mixin poster-active-state {

	&:hover,
	&.is-touched {
		@content;
	}
}

// Base styles
.wp-block-shm-poster {
	--poster-overlay-color: #000;
	--poster-overlay-color-rgb: 0, 0, 0;
	--poster-overlay-opacity: 0.6;
	--poster-overlay-opacity-hover: 0.8;
	--poster-overlay-height: 30%;
	--poster-overlay-height-hover: 100%;
	--poster-transition-duration: 400ms;
	--poster-transition-easing: ease-in-out;
	--poster-min-height: 400px;
	--poster-focal-x: 50%;
	--poster-focal-y: 50%;

	position: relative;
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
	align-items: stretch;
	box-sizing: border-box;
	overflow: hidden;
	width: 100%;
	height: 100%;
	min-height: var(--poster-min-height);
	background-color: #1a1a1a;
	flex: 1 1 auto;
	min-width: 0;

	&[style*="--poster-aspect-ratio"] {
		aspect-ratio: var(--poster-aspect-ratio);
		min-height: unset;
	}

	// Active states (hover and touch)
	@include poster-active-state {

		.shm-poster__overlay {
			height: var(--poster-overlay-height-hover);
			// stylelint-disable-next-line function-parentheses-space-inside
			background: rgba(var(--poster-overlay-color-rgb), var(--poster-overlay-opacity-hover));
		}
	}
}

// Make parent flex items stretch when containing a Poster block
*:has(> .wp-block-shm-poster),
.swiper-slide:has(.wp-block-shm-poster),
.splide__slide:has(.wp-block-shm-poster),
.glide__slide:has(.wp-block-shm-poster),
.slick-slide:has(.wp-block-shm-poster),
.flickity-slider > *:has(.wp-block-shm-poster) {
	align-self: stretch;
}

// Background image
.shm-poster__image {
	position: absolute;
	inset: 0;
	width: 100%;
	height: 100%;
	object-fit: cover;
	object-position: var(--poster-focal-x) var(--poster-focal-y);
	transition:
		filter var(--poster-transition-duration) var(--poster-transition-easing),
		transform var(--poster-transition-duration) var(--poster-transition-easing);
}

// Link wrapper
.shm-poster__link {
	display: block;
	position: absolute;
	inset: 0;
	text-decoration: none;
	color: inherit;
	cursor: pointer;

	&[data-no-link="true"] {
		cursor: default;
	}

	&:hover,
	&:focus,
	&:active {
		text-decoration: none;
		color: inherit;
	}

	&:focus-visible {
		outline: 2px solid #fff;
		outline-offset: -4px;
	}
}

// Overlay container - single container with reveal animation
.shm-poster__overlay {
	position: absolute;
	left: 0;
	right: 0;
	bottom: 0;
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
	padding: 1.5rem;
	box-sizing: border-box;
	color: #fff;
	overflow: hidden;
	height: var(--poster-overlay-height);
	// stylelint-disable-next-line function-parentheses-space-inside
	background: rgba(var(--poster-overlay-color-rgb), var(--poster-overlay-opacity));
	transition:
		height var(--poster-transition-duration) var(--poster-transition-easing),
		background var(--poster-transition-duration) var(--poster-transition-easing);
	z-index: 2;

	// Typography defaults
	a {
		color: inherit;
	}

	h1,
	h2,
	h3,
	h4,
	h5,
	h6 {
		margin-top: 0;
		margin-bottom: 0.5em;
		color: inherit;
	}

	p {
		margin-top: 0;
		margin-bottom: 0.5em;

		&:last-child {
			margin-bottom: 0;
		}
	}
}

// Hover content wrapper - hidden initially, revealed on hover
.wp-block-shm-poster-hover-content {
	margin-top: 0.5em;
}

// Position: Top
.wp-block-shm-poster--position-top {

	.shm-poster__overlay {
		top: 0;
		bottom: auto;
		justify-content: flex-start;
	}
}

// Animation: Slide (default) - height transition reveals content
.wp-block-shm-poster--animation-slide {

	.wp-block-shm-poster-hover-content {
		max-height: 0;
		overflow: hidden;
		opacity: 0;
		margin-top: 0;
		transition:
			max-height var(--poster-transition-duration) var(--poster-transition-easing),
			opacity var(--poster-transition-duration) var(--poster-transition-easing),
			margin-top var(--poster-transition-duration) var(--poster-transition-easing);
	}

	@include poster-active-state {

		.wp-block-shm-poster-hover-content {
			max-height: 500px;
			opacity: 1;
			margin-top: 0.5em;
		}
	}
}

// Animation: Fade - full overlay fades in/out
.wp-block-shm-poster--animation-fade {

	// stylelint-disable-next-line no-descending-specificity
	.shm-poster__overlay {
		height: 100%;
		opacity: var(--poster-overlay-opacity);
		// stylelint-disable-next-line function-parentheses-space-inside
		background: rgba(var(--poster-overlay-color-rgb), 1);
		transition: opacity var(--poster-transition-duration) var(--poster-transition-easing);
	}

	.wp-block-shm-poster-hover-content {
		opacity: 0;
		transition: opacity var(--poster-transition-duration) var(--poster-transition-easing);
	}

	@include poster-active-state {

		// stylelint-disable-next-line no-descending-specificity
		.shm-poster__overlay {
			opacity: var(--poster-overlay-opacity-hover);
		}

		.wp-block-shm-poster-hover-content {
			opacity: 1;
		}
	}
}

// Animation: Scale - overlay scales up
.wp-block-shm-poster--animation-scale {

	// stylelint-disable-next-line no-descending-specificity
	.shm-poster__overlay {
		height: 100%;
		transform: scaleY(0.3);
		transform-origin: bottom center;
		transition:
			transform var(--poster-transition-duration) var(--poster-transition-easing),
			background var(--poster-transition-duration) var(--poster-transition-easing);
	}

	.wp-block-shm-poster-hover-content {
		opacity: 0;
		transition: opacity var(--poster-transition-duration) var(--poster-transition-easing);
	}

	&.wp-block-shm-poster--position-top .shm-poster__overlay {
		transform-origin: top center;
	}

	@include poster-active-state {

		// stylelint-disable-next-line no-descending-specificity
		.shm-poster__overlay {
			transform: scaleY(1);
			// stylelint-disable-next-line function-parentheses-space-inside
			background: rgba(var(--poster-overlay-color-rgb), var(--poster-overlay-opacity-hover));
		}

		.wp-block-shm-poster-hover-content {
			opacity: 1;
		}
	}
}

// Animation: Blur - background blurs on hover
.wp-block-shm-poster--animation-blur {

	// stylelint-disable-next-line no-descending-specificity
	.shm-poster__overlay {
		height: 100%;
	}

	.wp-block-shm-poster-hover-content {
		opacity: 0;
		transition: opacity var(--poster-transition-duration) var(--poster-transition-easing);
	}

	@include poster-active-state {

		.shm-poster__image {
			filter: blur(8px);
			transform: scale(1.05);
		}

		// stylelint-disable-next-line no-descending-specificity
		.shm-poster__overlay {
			// stylelint-disable-next-line function-parentheses-space-inside
			background: rgba(var(--poster-overlay-color-rgb), var(--poster-overlay-opacity-hover));
		}

		.wp-block-shm-poster-hover-content {
			opacity: 1;
		}
	}
}

// Animation: Slide & Fade - combines slide with fade
.wp-block-shm-poster--animation-slide-fade {

	.wp-block-shm-poster-hover-content {
		opacity: 0;
		transform: translateY(10px);
		transition:
			opacity var(--poster-transition-duration) var(--poster-transition-easing),
			transform var(--poster-transition-duration) var(--poster-transition-easing);
	}

	@include poster-active-state {

		// stylelint-disable-next-line no-descending-specificity
		.shm-poster__overlay {
			height: var(--poster-overlay-height-hover);
			// stylelint-disable-next-line function-parentheses-space-inside
			background: rgba(var(--poster-overlay-color-rgb), var(--poster-overlay-opacity-hover));
		}

		.wp-block-shm-poster-hover-content {
			opacity: 1;
			transform: translateY(0);
		}
	}
}

// Accessibility: Focus states
.wp-block-shm-poster:has(.shm-poster__link:focus-visible) {

	// stylelint-disable-next-line no-descending-specificity
	.shm-poster__overlay {
		height: var(--poster-overlay-height-hover);
		// stylelint-disable-next-line function-parentheses-space-inside
		background: rgba(var(--poster-overlay-color-rgb), var(--poster-overlay-opacity-hover));
	}

	.wp-block-shm-poster-hover-content {
		opacity: 1;
		transform: none;
	}
}

// Accessibility: Reduced motion
@media (prefers-reduced-motion: reduce) {

	.wp-block-shm-poster,
	.wp-block-shm-poster *,
	.wp-block-shm-poster *::before,
	.wp-block-shm-poster *::after {
		transition-duration: 0.01ms !important;
		animation-duration: 0.01ms !important;
	}
}
